---
import CustomNav from '../../components/CustomNav.astro';
import Footer from '../../components/Footer.astro';
import LanguageSwitcher from '../../components/LanguageSwitcher.astro';

const title = 'CobbleRanked Leaderboard Demo';
const description = 'Live demo of ranked leaderboard data from CobbleRanked API.';
---

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="icon" type="image/png" href="/gashistudios.png" />
	<meta name="description" content={description} />
	<title>{title}</title>
	<meta property="og:title" content={title} />
	<meta property="og:description" content={description} />
	<meta name="theme-color" content="#7c3aed" />
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
</head>
<body>
	<CustomNav />

	<!-- Hero Section -->
	<section class="hero-section">
		<div class="hero-bg"></div>
		<div class="hero-content">
			<h1 class="hero-title">
				<span class="title-icon">
					<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
					</svg>
				</span>
				Ranked Leaderboard
			</h1>
			<p class="hero-subtitle">Top players competing for glory in CobbleRanked</p>

			<!-- Format Selector -->
			<div class="format-selector">
				<button class="format-btn active" data-format="SINGLES">Singles</button>
				<button class="format-btn" data-format="DOUBLES">Doubles</button>
				<button class="format-btn" data-format="TRIPLES">Triples</button>
			</div>
		</div>
	</section>

	<!-- Leaderboard Section -->
	<section class="leaderboard-section">
		<div class="container">
			<!-- Season Info -->
			<div class="season-info">
				<div class="season-badge">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<circle cx="12" cy="12" r="10"/>
						<path d="M12 6v6l4 2"/>
					</svg>
					<span>Season 4</span>
				</div>
				<div class="last-updated">Last updated: Just now</div>
			</div>

			<!-- Leaderboard Table -->
			<div class="leaderboard-table-wrapper">
				<table class="leaderboard-table" id="leaderboard-table">
					<thead>
						<tr>
							<th class="col-rank">RANK</th>
							<th class="col-player">PLAYER</th>
							<th class="col-elo">ELO</th>
							<th class="col-tier">TIER</th>
							<th class="col-record">W / L</th>
							<th class="col-winrate">WIN RATE</th>
							<th class="col-streak">STREAK</th>
							<th class="col-best">BEST</th>
						</tr>
					</thead>
					<tbody id="leaderboard-body">
						<!-- Populated by JavaScript -->
					</tbody>
				</table>
			</div>
		</div>
	</section>

	<!-- API Info Section -->
	<section class="api-info-section">
		<div class="container">
			<div class="api-card">
				<div class="api-card-header">
					<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M12 2L2 7l10 5 10-5-10-5z"/>
						<path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
					</svg>
					<h3>CobbleRanked Web API</h3>
				</div>
				<p class="api-desc">
					This demo showcases leaderboard data that can be synced from your CobbleRanked server to your website using the Web API integration.
					Display live rankings, player stats, and tier information on your community website.
				</p>
				<a href="/docs/cobbleranked/configuration/api/" class="api-link">
					<span>Learn more about API configuration</span>
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M5 12h14M12 5l7 7-7 7"/>
					</svg>
				</a>
			</div>
		</div>
	</section>

	<Footer />
	<LanguageSwitcher />

	<script is:inline>
	(function() {
		// Tier definitions with colors
		const tiers = {
			CHERISH: { name: 'Cherish', color: '#ec4899', bg: 'rgba(236, 72, 153, 0.2)' },
			ULTRA: { name: 'Ultra', color: '#f59e0b', bg: 'rgba(245, 158, 11, 0.2)' },
			GREAT: { name: 'Great', color: '#3b82f6', bg: 'rgba(59, 130, 246, 0.2)' },
			POKE: { name: 'Poke', color: '#ef4444', bg: 'rgba(239, 68, 68, 0.2)' },
			PREMIER: { name: 'Premier', color: '#a1a1aa', bg: 'rgba(161, 161, 170, 0.2)' }
		};

		// State
		let leaderboardData = [];
		let currentSeason = 'Season4';
		let currentFormat = 'SINGLES';
		let isLoading = false;

		// Fetch leaderboard from API
		async function fetchLeaderboard() {
			isLoading = true;
			updateLoadingState();

			try {
				const response = await fetch(`/api/cobbleranked/leaderboard?serverId=battle&season=${currentSeason}&format=${currentFormat}`);
				const data = await response.json();

				// Extract players from response
				if (data.players) {
					leaderboardData = data.players.map(p => ({
						rank: p.rank,
						uuid: p.uuid,
						name: p.name,
						elo: p.elo,
						tier: p.tier,
						wins: p.wins,
						losses: p.losses,
						streak: p.currentStreak || 0,
						best: p.bestStreak || 0
					}));
				} else if (data.seasons?.[currentSeason]?.formats?.[currentFormat]?.players) {
					leaderboardData = data.seasons[currentSeason].formats[currentFormat].players.map(p => ({
						rank: p.rank,
						uuid: p.uuid,
						name: p.name,
						elo: p.elo,
						tier: p.tier,
						wins: p.wins,
						losses: p.losses,
						streak: p.currentStreak || 0,
						best: p.bestStreak || 0
					}));
				}

				// Update demo indicator
				const lastUpdated = document.querySelector('.last-updated');
				if (data.isDemo) {
					lastUpdated.textContent = 'Demo Data';
					lastUpdated.style.color = '#f59e0b';
				} else {
					const timestamp = data.timestamp ? new Date(data.timestamp).toLocaleString() : 'Just now';
					lastUpdated.textContent = `Last updated: ${timestamp}`;
					lastUpdated.style.color = '';
				}
			} catch (error) {
				console.error('Failed to fetch leaderboard:', error);
			}

			isLoading = false;
			updateLoadingState();
			renderLeaderboard();
		}

		function updateLoadingState() {
			const tbody = document.getElementById('leaderboard-body');
			if (isLoading) {
				tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.5);">Loading...</td></tr>';
			}
		}

		function getRankClass(rank) {
			if (rank === 1) return 'rank-gold';
			if (rank === 2) return 'rank-silver';
			if (rank === 3) return 'rank-bronze';
			return '';
		}

		function renderLeaderboard() {
			const tbody = document.getElementById('leaderboard-body');
			tbody.innerHTML = '';

			leaderboardData.forEach((player, index) => {
				const tier = tiers[player.tier];
				const winRate = ((player.wins / (player.wins + player.losses)) * 100).toFixed(1);
				const row = document.createElement('tr');
				row.className = 'leaderboard-row';
				row.style.animationDelay = `${index * 0.05}s`;

				row.innerHTML = `
					<td class="col-rank">
						<span class="rank-badge ${getRankClass(player.rank)}">#${player.rank}</span>
					</td>
					<td class="col-player">
						<div class="player-info">
							<img
								class="player-avatar"
								src="https://crafatar.com/avatars/${player.uuid}?size=32&overlay"
								alt="${player.name}"
								loading="lazy"
							/>
							<span class="player-name" style="background: ${tier.bg}; color: ${tier.color};">${player.name}</span>
						</div>
					</td>
					<td class="col-elo">
						<span class="elo-value">${player.elo.toLocaleString()}</span>
					</td>
					<td class="col-tier">
						<span class="tier-badge" style="background: ${tier.bg}; color: ${tier.color}; border-color: ${tier.color};">
							${tier.name}
						</span>
					</td>
					<td class="col-record">
						<span class="wins">${player.wins}</span>
						<span class="separator">/</span>
						<span class="losses">${player.losses}</span>
					</td>
					<td class="col-winrate">
						<div class="winrate-container">
							<span class="winrate-value">${winRate}%</span>
							<div class="winrate-bar">
								<div class="winrate-fill" style="width: ${winRate}%;"></div>
							</div>
						</div>
					</td>
					<td class="col-streak">
						<span class="streak-value ${player.streak > 0 ? 'positive' : ''}">${player.streak > 0 ? '+' + player.streak : player.streak}</span>
					</td>
					<td class="col-best">
						<span class="best-value">${player.best}</span>
					</td>
				`;

				tbody.appendChild(row);
			});
		}

		// Format selector
		document.querySelectorAll('.format-btn').forEach(btn => {
			btn.addEventListener('click', () => {
				document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
				btn.classList.add('active');
				currentFormat = btn.dataset.format;
				fetchLeaderboard();
			});
		});

		// Initialize - fetch from API
		fetchLeaderboard();
	})();
	</script>

	<style is:global>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		html {
			scroll-behavior: smooth;
		}

		body {
			font-family: 'Noto Sans JP', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
			background: #0f1419;
			color: #fff;
			line-height: 1.6;
			overflow-x: hidden;
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 0 2rem;
		}

		/* Hero Section */
		.hero-section {
			position: relative;
			padding: 160px 2rem 80px;
			text-align: center;
			overflow: hidden;
		}

		.hero-bg {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background:
				radial-gradient(ellipse at 50% 0%, rgba(124, 58, 237, 0.15) 0%, transparent 60%),
				radial-gradient(ellipse at 80% 50%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
				radial-gradient(ellipse at 20% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
			pointer-events: none;
		}

		.hero-content {
			position: relative;
			z-index: 1;
		}

		.hero-title {
			font-size: 3rem;
			font-weight: 800;
			margin-bottom: 1rem;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 1rem;
			background: linear-gradient(135deg, #fff 0%, #a78bfa 50%, #ec4899 100%);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.title-icon {
			display: flex;
			align-items: center;
			justify-content: center;
			color: #f59e0b;
			animation: pulse 2s ease-in-out infinite;
		}

		@keyframes pulse {
			0%, 100% { transform: scale(1); opacity: 1; }
			50% { transform: scale(1.1); opacity: 0.8; }
		}

		.hero-subtitle {
			font-size: 1.25rem;
			color: rgba(255, 255, 255, 0.6);
			margin-bottom: 2rem;
		}

		/* Format Selector */
		.format-selector {
			display: flex;
			justify-content: center;
			gap: 0.5rem;
		}

		.format-btn {
			padding: 0.75rem 2rem;
			background: rgba(255, 255, 255, 0.05);
			border: 1px solid rgba(255, 255, 255, 0.1);
			border-radius: 8px;
			color: rgba(255, 255, 255, 0.7);
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s ease;
		}

		.format-btn:hover {
			background: rgba(255, 255, 255, 0.1);
			border-color: rgba(255, 255, 255, 0.2);
		}

		.format-btn.active {
			background: linear-gradient(135deg, rgba(124, 58, 237, 0.3), rgba(236, 72, 153, 0.3));
			border-color: rgba(124, 58, 237, 0.5);
			color: #fff;
		}

		/* Leaderboard Section */
		.leaderboard-section {
			padding: 2rem 0 4rem;
		}

		.season-info {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 1.5rem;
		}

		.season-badge {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.5rem 1rem;
			background: rgba(124, 58, 237, 0.2);
			border: 1px solid rgba(124, 58, 237, 0.3);
			border-radius: 20px;
			color: #a78bfa;
			font-weight: 600;
		}

		.last-updated {
			color: rgba(255, 255, 255, 0.5);
			font-size: 0.875rem;
		}

		/* Leaderboard Table */
		.leaderboard-table-wrapper {
			overflow-x: auto;
			border-radius: 12px;
			background: rgba(255, 255, 255, 0.02);
			border: 1px solid rgba(255, 255, 255, 0.08);
		}

		.leaderboard-table {
			width: 100%;
			border-collapse: collapse;
			min-width: 800px;
		}

		.leaderboard-table thead {
			background: rgba(0, 0, 0, 0.3);
		}

		.leaderboard-table th {
			padding: 1rem 1.25rem;
			text-align: left;
			font-size: 0.75rem;
			font-weight: 700;
			color: rgba(255, 255, 255, 0.5);
			letter-spacing: 0.1em;
			text-transform: uppercase;
			border-bottom: 1px solid rgba(255, 255, 255, 0.08);
		}

		.leaderboard-table td {
			padding: 1rem 1.25rem;
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
		}

		.leaderboard-row {
			transition: all 0.2s ease;
			animation: fadeSlideIn 0.5s ease forwards;
			opacity: 0;
		}

		@keyframes fadeSlideIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.leaderboard-row:hover {
			background: rgba(255, 255, 255, 0.03);
		}

		/* Rank */
		.col-rank {
			width: 80px;
		}

		.rank-badge {
			display: inline-flex;
			align-items: center;
			justify-content: center;
			min-width: 48px;
			padding: 0.375rem 0.75rem;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 6px;
			font-weight: 700;
			font-size: 0.9375rem;
		}

		.rank-badge.rank-gold {
			background: linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(251, 191, 36, 0.3));
			color: #fbbf24;
			box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
		}

		.rank-badge.rank-silver {
			background: linear-gradient(135deg, rgba(156, 163, 175, 0.3), rgba(209, 213, 219, 0.3));
			color: #d1d5db;
			box-shadow: 0 0 15px rgba(156, 163, 175, 0.2);
		}

		.rank-badge.rank-bronze {
			background: linear-gradient(135deg, rgba(180, 83, 9, 0.3), rgba(217, 119, 6, 0.3));
			color: #d97706;
			box-shadow: 0 0 15px rgba(180, 83, 9, 0.2);
		}

		/* Player */
		.col-player {
			min-width: 200px;
		}

		.player-info {
			display: flex;
			align-items: center;
			gap: 0.75rem;
		}

		.player-avatar {
			width: 32px;
			height: 32px;
			border-radius: 4px;
			image-rendering: pixelated;
			background: rgba(255, 255, 255, 0.1);
		}

		.player-name {
			padding: 0.375rem 0.75rem;
			border-radius: 4px;
			font-weight: 600;
			font-size: 0.9375rem;
		}

		/* ELO */
		.col-elo {
			width: 100px;
		}

		.elo-value {
			font-weight: 700;
			font-size: 1.0625rem;
			color: #fff;
		}

		/* Tier */
		.col-tier {
			width: 100px;
		}

		.tier-badge {
			display: inline-block;
			padding: 0.375rem 0.75rem;
			border-radius: 4px;
			border: 1px solid;
			font-weight: 600;
			font-size: 0.8125rem;
		}

		/* Record */
		.col-record {
			width: 100px;
		}

		.wins {
			color: #22c55e;
			font-weight: 600;
		}

		.separator {
			color: rgba(255, 255, 255, 0.3);
			margin: 0 0.25rem;
		}

		.losses {
			color: #ef4444;
			font-weight: 600;
		}

		/* Win Rate */
		.col-winrate {
			width: 140px;
		}

		.winrate-container {
			display: flex;
			flex-direction: column;
			gap: 0.25rem;
		}

		.winrate-value {
			font-weight: 600;
			font-size: 0.875rem;
		}

		.winrate-bar {
			width: 100%;
			height: 4px;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 2px;
			overflow: hidden;
		}

		.winrate-fill {
			height: 100%;
			background: linear-gradient(90deg, #22c55e, #86efac);
			border-radius: 2px;
			transition: width 0.5s ease;
		}

		/* Streak */
		.col-streak {
			width: 80px;
		}

		.streak-value {
			font-weight: 600;
			color: rgba(255, 255, 255, 0.6);
		}

		.streak-value.positive {
			color: #22c55e;
		}

		/* Best */
		.col-best {
			width: 80px;
		}

		.best-value {
			font-weight: 600;
			color: #f59e0b;
		}

		/* API Info Section */
		.api-info-section {
			padding: 4rem 0;
			background: linear-gradient(180deg, transparent 0%, rgba(124, 58, 237, 0.05) 100%);
		}

		.api-card {
			background: rgba(255, 255, 255, 0.03);
			border: 1px solid rgba(255, 255, 255, 0.08);
			border-radius: 16px;
			padding: 2rem;
			max-width: 800px;
			margin: 0 auto;
		}

		.api-card-header {
			display: flex;
			align-items: center;
			gap: 0.75rem;
			margin-bottom: 1rem;
			color: #a78bfa;
		}

		.api-card-header h3 {
			font-size: 1.25rem;
			font-weight: 700;
			color: #fff;
		}

		.api-desc {
			color: rgba(255, 255, 255, 0.7);
			line-height: 1.7;
			margin-bottom: 1.5rem;
		}

		.api-link {
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			color: #a78bfa;
			text-decoration: none;
			font-weight: 500;
			transition: all 0.2s ease;
		}

		.api-link:hover {
			color: #c4b5fd;
		}

		/* Responsive */
		@media (max-width: 768px) {
			.hero-title {
				font-size: 2rem;
				flex-direction: column;
				gap: 0.5rem;
			}

			.format-selector {
				flex-direction: column;
				align-items: stretch;
				max-width: 300px;
				margin: 0 auto;
			}

			.format-btn {
				padding: 0.625rem 1rem;
			}

			.season-info {
				flex-direction: column;
				gap: 0.75rem;
				text-align: center;
			}

			.leaderboard-table th,
			.leaderboard-table td {
				padding: 0.75rem 0.625rem;
			}
		}
	</style>
</body>
</html>
