---
// Products section showcasing mods - with MOTION-style title animation
---

<section id="products" class="products-section">
	<div class="products-container">
		<!-- Animated Title -->
		<div class="title-wrapper" id="products-title-wrapper">
			<!-- Decorative dots -->
			<div class="title-dots">
				<span class="dot dot-1"></span>
				<span class="dot dot-2"></span>
				<span class="dot dot-3"></span>
			</div>
			<!-- Main title with individual characters -->
			<h2 class="section-title animated-title" id="products-title">
				<span class="char" data-index="0">O</span>
				<span class="char" data-index="1">u</span>
				<span class="char" data-index="2">r</span>
				<span class="char space" data-index="3">&nbsp;</span>
				<span class="char" data-index="4">P</span>
				<span class="char" data-index="5">r</span>
				<span class="char" data-index="6">o</span>
				<span class="char" data-index="7">d</span>
				<span class="char" data-index="8">u</span>
				<span class="char" data-index="9">c</span>
				<span class="char" data-index="10">t</span>
				<span class="char" data-index="11">s</span>
			</h2>
			<!-- Japanese version (hidden by default, shown when ja) -->
			<h2 class="section-title animated-title ja-title" id="products-title-ja" style="display: none;">
				<span class="char" data-index="0">プ</span>
				<span class="char" data-index="1">ロ</span>
				<span class="char" data-index="2">ダ</span>
				<span class="char" data-index="3">ク</span>
				<span class="char" data-index="4">ト</span>
			</h2>
			<!-- Subtitle -->
			<p class="section-subtitle animated-subtitle" id="products-subtitle">
				<span class="subtitle-text" data-i18n="productsSubtitle">Mods and libraries for Cobblemon</span>
			</p>
		</div>

		<div class="products-grid">
			<a href="/docs/cobbleranked/" class="product-card featured">
				<div class="product-icon">
					<img src="/cobbleranked.png" alt="CobbleRanked" />
				</div>
				<div class="product-info">
					<h3>CobbleRanked</h3>
					<p data-i18n="cobblerankedDesc">ELO-based ranked battle system with seasons, leaderboards, and rewards.</p>
					<span class="product-tag">Featured</span>
				</div>
			</a>

			<a href="/docs/gashilibs/" class="product-card">
				<div class="product-icon library">
					<svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
						<path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
					</svg>
				</div>
				<div class="product-info">
					<h3>GashiLibs</h3>
					<p data-i18n="gashilibsDesc">Shared library providing database connections, Redis, and config utilities.</p>
					<span class="product-tag library">Library</span>
				</div>
			</a>

			<a href="/docs/maillib/" class="product-card">
				<div class="product-icon library">
					<svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
						<path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
					</svg>
				</div>
				<div class="product-info">
					<h3>MailLib</h3>
					<p data-i18n="maillibDesc">In-game mailbox system for delivering rewards and items to players.</p>
					<span class="product-tag library">Library</span>
				</div>
			</a>
		</div>
	</div>
</section>

<script is:inline>
(function() {
	const translations = {
		en: {
			productsSubtitle: "Mods and libraries for Cobblemon",
			cobblerankedDesc: "ELO-based ranked battle system with seasons, leaderboards, and rewards.",
			gashilibsDesc: "Shared library providing database connections, Redis, and config utilities.",
			maillibDesc: "In-game mailbox system for delivering rewards and items to players."
		},
		ja: {
			productsSubtitle: "Cobblemon向けMod・ライブラリ",
			cobblerankedDesc: "ELOレーティングを採用したランクバトルシステム。シーズン、リーダーボード、報酬機能を搭載。",
			gashilibsDesc: "データベース接続、Redis、設定管理などの共有ライブラリ。",
			maillibDesc: "プレイヤーに報酬やアイテムを届けるゲーム内メールシステム。"
		}
	};

	let currentLang = 'en';
	let hasAnimated = false;

	function applyProductsTranslations(lang) {
		currentLang = lang;
		const t = translations[lang] || translations.en;

		// Handle title switching
		const enTitle = document.getElementById('products-title');
		const jaTitle = document.getElementById('products-title-ja');

		if (lang === 'ja') {
			enTitle.style.display = 'none';
			jaTitle.style.display = 'flex';
		} else {
			enTitle.style.display = 'flex';
			jaTitle.style.display = 'none';
		}

		// Apply other translations
		document.querySelectorAll('.products-section [data-i18n]').forEach(el => {
			const key = el.getAttribute('data-i18n');
			if (t[key]) {
				el.innerHTML = t[key];
			}
		});

		// Re-trigger animation if already visible and language changed
		if (hasAnimated) {
			resetAnimation();
			playAnimation();
		}
	}

	function resetAnimation() {
		const wrapper = document.getElementById('products-title-wrapper');
		const activeTitle = currentLang === 'ja'
			? document.getElementById('products-title-ja')
			: document.getElementById('products-title');
		const chars = activeTitle.querySelectorAll('.char');
		const dots = wrapper.querySelectorAll('.dot');
		const subtitle = wrapper.querySelector('.animated-subtitle');

		chars.forEach(char => {
			char.classList.remove('visible');
		});
		dots.forEach(dot => {
			dot.classList.remove('visible');
		});
		subtitle.classList.remove('visible');
	}

	function playAnimation() {
		const wrapper = document.getElementById('products-title-wrapper');
		const activeTitle = currentLang === 'ja'
			? document.getElementById('products-title-ja')
			: document.getElementById('products-title');
		const chars = activeTitle.querySelectorAll('.char');
		const dots = wrapper.querySelectorAll('.dot');
		const subtitle = wrapper.querySelector('.animated-subtitle');

		// Animate dots first (staggered)
		dots.forEach((dot, i) => {
			setTimeout(() => {
				dot.classList.add('visible');
			}, i * 100);
		});

		// Animate characters with stagger
		const charDelay = 60;
		chars.forEach((char, i) => {
			setTimeout(() => {
				char.classList.add('visible');
			}, 200 + i * charDelay);
		});

		// Animate subtitle after all chars
		const totalCharTime = 200 + chars.length * charDelay + 200;
		setTimeout(() => {
			subtitle.classList.add('visible');
		}, totalCharTime);

		hasAnimated = true;
	}

	// Intersection Observer for scroll-triggered animation
	function setupIntersectionObserver() {
		const wrapper = document.getElementById('products-title-wrapper');
		if (!wrapper) return;

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting && !hasAnimated) {
					playAnimation();
				}
			});
		}, {
			threshold: 0.3,
			rootMargin: '0px 0px -100px 0px'
		});

		observer.observe(wrapper);
	}

	// Initialize
	function init() {
		const lang = window.GashiLang?.get() || 'en';
		applyProductsTranslations(lang);
		setupIntersectionObserver();
	}

	// Listen for language changes
	window.addEventListener('langChange', (e) => {
		applyProductsTranslations(e.detail.lang);
	});

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', init);
	} else {
		init();
	}
})();
</script>

<style>
.products-section {
	padding: 6rem 2rem;
	background: #0f0a1a;
}

.products-container {
	max-width: 1200px;
	margin: 0 auto;
}

/* ===== Animated Title Styles ===== */
.title-wrapper {
	position: relative;
	text-align: center;
	margin-bottom: 3rem;
	padding-top: 2rem;
}

/* Decorative dots */
.title-dots {
	position: absolute;
	top: 0;
	left: 50%;
	transform: translateX(-50%);
	display: flex;
	gap: 0.75rem;
	justify-content: center;
}

.dot {
	width: 6px;
	height: 6px;
	background: rgba(167, 139, 250, 0.8);
	border-radius: 50%;
	opacity: 0;
	transform: translateY(10px) scale(0);
	transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.dot.visible {
	opacity: 1;
	transform: translateY(0) scale(1);
}

.dot-1 { transition-delay: 0s; }
.dot-2 { transition-delay: 0.1s; background: rgba(124, 58, 237, 0.9); width: 8px; height: 8px; }
.dot-3 { transition-delay: 0.2s; }

/* Animated title */
.animated-title {
	display: flex;
	justify-content: center;
	align-items: baseline;
	gap: 0;
	font-size: 2.5rem;
	font-weight: 700;
	color: #fff;
	margin-bottom: 0.75rem;
	letter-spacing: 0.05em;
}

.animated-title .char {
	display: inline-block;
	opacity: 0;
	transform: translateY(30px);
	transition:
		opacity 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
		transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.animated-title .char.visible {
	opacity: 1;
	transform: translateY(0);
}

.animated-title .char.space {
	width: 0.3em;
}

/* Japanese title adjustments */
.ja-title {
	letter-spacing: 0.15em;
}

/* Animated subtitle */
.animated-subtitle {
	opacity: 0;
	transform: translateY(15px);
	transition:
		opacity 0.6s ease,
		transform 0.6s ease;
}

.animated-subtitle.visible {
	opacity: 1;
	transform: translateY(0);
}

.subtitle-text {
	color: rgba(255, 255, 255, 0.6);
	font-size: 1rem;
}

/* ===== Product Grid Styles ===== */
.products-grid {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
	gap: 1.5rem;
}

.product-card {
	background: linear-gradient(135deg, rgba(26, 16, 51, 0.8) 0%, rgba(15, 10, 26, 0.8) 100%);
	border: 1px solid rgba(124, 58, 237, 0.2);
	border-radius: 1rem;
	padding: 2rem;
	text-decoration: none;
	transition: all 0.3s ease;
	display: flex;
	gap: 1.5rem;
	align-items: flex-start;
}

.product-card:hover {
	border-color: rgba(124, 58, 237, 0.5);
	transform: translateY(-5px);
	box-shadow: 0 15px 40px rgba(124, 58, 237, 0.2);
}

.product-card.featured {
	border-color: rgba(124, 58, 237, 0.4);
	background: linear-gradient(135deg, rgba(124, 58, 237, 0.15) 0%, rgba(15, 10, 26, 0.9) 100%);
}

.product-icon {
	flex-shrink: 0;
	width: 80px;
	height: 80px;
	border-radius: 12px;
	overflow: hidden;
	display: flex;
	align-items: center;
	justify-content: center;
}

.product-icon img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.product-icon.library {
	background: rgba(124, 58, 237, 0.2);
	color: #a78bfa;
}

.product-icon.library svg {
	width: 36px;
	height: 36px;
}

.product-info h3 {
	font-size: 1.25rem;
	font-weight: 600;
	color: #fff;
	margin-bottom: 0.5rem;
}

.product-info p {
	color: rgba(255, 255, 255, 0.7);
	font-size: 0.9rem;
	line-height: 1.6;
	margin-bottom: 1rem;
}

.product-tag {
	display: inline-block;
	background: linear-gradient(135deg, #7c3aed, #9333ea);
	color: #fff;
	font-size: 0.75rem;
	font-weight: 600;
	padding: 0.25rem 0.75rem;
	border-radius: 20px;
}

.product-tag.library {
	background: rgba(124, 58, 237, 0.3);
	color: #a78bfa;
}

/* ===== Responsive ===== */
@media (max-width: 768px) {
	.products-section {
		padding: 4rem 1rem;
	}

	.animated-title {
		font-size: 2rem;
	}

	.product-card {
		flex-direction: column;
		text-align: center;
		align-items: center;
	}
}
</style>
