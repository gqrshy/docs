---
// Testimonials section with glowing line reveal animation
---

<section id="testimonials" class="testimonials-section">
	<div class="testimonials-container">
		<!-- Animated Title with glowing line reveal -->
		<div class="title-wrapper" id="testimonials-title-wrapper">
			<div class="glow-title-container">
				<!-- Glowing sweep line -->
				<div class="glow-line" id="testimonials-glow-line"></div>
				<!-- English title -->
				<h2 class="section-title glow-title" id="testimonials-title-en">
					<span class="char">W</span>
					<span class="char">h</span>
					<span class="char">a</span>
					<span class="char">t</span>
					<span class="char space">&nbsp;</span>
					<span class="char">U</span>
					<span class="char">s</span>
					<span class="char">e</span>
					<span class="char">r</span>
					<span class="char">s</span>
					<span class="char space">&nbsp;</span>
					<span class="char">S</span>
					<span class="char">a</span>
					<span class="char">y</span>
				</h2>
				<!-- Japanese title -->
				<h2 class="section-title glow-title ja-title" id="testimonials-title-ja" style="display: none;">
					<span class="char">ユ</span>
					<span class="char">ー</span>
					<span class="char">ザ</span>
					<span class="char">ー</span>
					<span class="char">レ</span>
					<span class="char">ビ</span>
					<span class="char">ュ</span>
					<span class="char">ー</span>
				</h2>
			</div>
			<!-- Subtitle -->
			<p class="section-subtitle animated-subtitle" id="testimonials-subtitle">
				<span class="subtitle-text" data-i18n="testimonialsSubtitle">Feedback from our community</span>
			</p>
		</div>

		<div class="testimonials-grid">
			<div class="testimonial-card">
				<div class="testimonial-header">
					<div class="testimonial-avatar">L</div>
					<div class="testimonial-info">
						<span class="testimonial-name">Luan</span>
						<div class="testimonial-rating">
							<span class="stars">★★★★★</span>
							<span class="rating-text">10/10</span>
						</div>
					</div>
				</div>
				<p class="testimonial-text" data-i18n="testimonialLuan">
					10/10 service, quick and efficient. 10/10 problem solving, all problems encountered were solved very quickly.
				</p>
			</div>

			<div class="testimonial-card">
				<div class="testimonial-header">
					<div class="testimonial-avatar">D</div>
					<div class="testimonial-info">
						<span class="testimonial-name">diego_crd</span>
						<div class="testimonial-rating">
							<span class="stars">★★★★★</span>
							<span class="rating-text">10/10</span>
						</div>
					</div>
				</div>
				<p class="testimonial-text" data-i18n="testimonialDiego">
					I am delighted, excellent customer service, I recommend 10/10.
				</p>
			</div>

			<div class="testimonial-card">
				<div class="testimonial-header">
					<div class="testimonial-avatar">S</div>
					<div class="testimonial-info">
						<span class="testimonial-name">Silverflames123</span>
						<div class="testimonial-rating">
							<span class="stars">★★★★★</span>
							<span class="rating-text">10/10</span>
						</div>
					</div>
				</div>
				<p class="testimonial-text" data-i18n="testimonialSilver">
					10/10 Quality, 10/10 Service. Extremely well made and very responsive to issues.
				</p>
			</div>
		</div>
	</div>
</section>

<script is:inline>
(function() {
	const translations = {
		en: {
			testimonialsSubtitle: "Feedback from our community",
			testimonialLuan: "10/10 service, quick and efficient. 10/10 problem solving, all problems encountered were solved very quickly.",
			testimonialDiego: "I am delighted, excellent customer service, I recommend 10/10.",
			testimonialSilver: "10/10 Quality, 10/10 Service. Extremely well made and very responsive to issues."
		},
		ja: {
			testimonialsSubtitle: "コミュニティからの声",
			testimonialLuan: "サービス10点満点！迅速かつ効率的。問題解決も10点満点！発生した問題はすべて素早く解決してもらえました。",
			testimonialDiego: "大満足です。カスタマーサポートが素晴らしく、10点満点でおすすめします。",
			testimonialSilver: "クオリティ10点満点、サービス10点満点。非常に丁寧に作られており、問題対応も迅速です。"
		}
	};

	let currentLang = 'en';
	let hasAnimated = false;

	function applyTestimonialsTranslations(lang) {
		currentLang = lang;
		const t = translations[lang] || translations.en;

		// Handle title switching
		const enTitle = document.getElementById('testimonials-title-en');
		const jaTitle = document.getElementById('testimonials-title-ja');

		if (lang === 'ja') {
			enTitle.style.display = 'none';
			jaTitle.style.display = 'flex';
		} else {
			enTitle.style.display = 'flex';
			jaTitle.style.display = 'none';
		}

		// Apply other translations
		document.querySelectorAll('.testimonials-section [data-i18n]').forEach(el => {
			const key = el.getAttribute('data-i18n');
			if (t[key]) {
				el.innerHTML = t[key];
			}
		});

		// Re-trigger animation if language changed after animation
		if (hasAnimated) {
			resetAnimation();
			playAnimation();
		}
	}

	function resetAnimation() {
		const wrapper = document.getElementById('testimonials-title-wrapper');
		const glowLine = document.getElementById('testimonials-glow-line');
		const activeTitle = currentLang === 'ja'
			? document.getElementById('testimonials-title-ja')
			: document.getElementById('testimonials-title-en');
		const chars = activeTitle.querySelectorAll('.char');
		const subtitle = wrapper.querySelector('.animated-subtitle');

		// Reset glow line
		glowLine.classList.remove('animate');

		// Reset chars
		chars.forEach(char => {
			char.classList.remove('visible', 'glow');
		});

		// Reset subtitle
		subtitle.classList.remove('visible');
	}

	function playAnimation() {
		const wrapper = document.getElementById('testimonials-title-wrapper');
		const glowLine = document.getElementById('testimonials-glow-line');
		const activeTitle = currentLang === 'ja'
			? document.getElementById('testimonials-title-ja')
			: document.getElementById('testimonials-title-en');
		const chars = activeTitle.querySelectorAll('.char');
		const subtitle = wrapper.querySelector('.animated-subtitle');

		// Start glow line animation
		glowLine.classList.add('animate');

		// Reveal characters as glow line passes
		const lineAnimDuration = 800; // ms
		const charCount = chars.length;

		chars.forEach((char, i) => {
			const delay = (i / charCount) * lineAnimDuration;
			setTimeout(() => {
				char.classList.add('glow');
				setTimeout(() => {
					char.classList.add('visible');
					char.classList.remove('glow');
				}, 150);
			}, delay + 100);
		});

		// Show subtitle after characters
		setTimeout(() => {
			subtitle.classList.add('visible');
		}, lineAnimDuration + 400);

		hasAnimated = true;
	}

	// Intersection Observer for scroll-triggered animation
	function setupIntersectionObserver() {
		const wrapper = document.getElementById('testimonials-title-wrapper');
		if (!wrapper) return;

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting && !hasAnimated) {
					playAnimation();
				}
			});
		}, {
			threshold: 0.3,
			rootMargin: '0px 0px -100px 0px'
		});

		observer.observe(wrapper);
	}

	// Initialize
	function init() {
		const lang = window.GashiLang?.get() || 'en';
		applyTestimonialsTranslations(lang);
		setupIntersectionObserver();
	}

	// Listen for language changes
	window.addEventListener('langChange', (e) => {
		applyTestimonialsTranslations(e.detail.lang);
	});

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', init);
	} else {
		init();
	}
})();
</script>

<style>
.testimonials-section {
	padding: 6rem 2rem;
	background: linear-gradient(135deg, #d4c8e8 0%, #c8d4f0 100%);
}

.testimonials-container {
	max-width: 1200px;
	margin: 0 auto;
}

/* ===== Glowing Line Title Animation ===== */
.title-wrapper {
	position: relative;
	text-align: center;
	margin-bottom: 3rem;
}

.glow-title-container {
	position: relative;
	display: inline-block;
	overflow: visible;
}

/* Glowing sweep line */
.glow-line {
	position: absolute;
	top: 50%;
	left: -20px;
	width: 3px;
	height: 120%;
	transform: translateY(-50%);
	background: linear-gradient(
		180deg,
		transparent 0%,
		rgba(124, 108, 154, 0.3) 20%,
		rgba(124, 108, 154, 1) 50%,
		rgba(124, 108, 154, 0.3) 80%,
		transparent 100%
	);
	box-shadow:
		0 0 20px rgba(124, 108, 154, 0.8),
		0 0 40px rgba(124, 108, 154, 0.6),
		0 0 60px rgba(124, 108, 154, 0.4);
	opacity: 0;
	z-index: 10;
	pointer-events: none;
}

.glow-line.animate {
	animation: glowSweep 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

@keyframes glowSweep {
	0% {
		left: -20px;
		opacity: 1;
	}
	90% {
		opacity: 1;
	}
	100% {
		left: calc(100% + 20px);
		opacity: 0;
	}
}

/* Title text */
.glow-title {
	display: flex;
	justify-content: center;
	align-items: baseline;
	gap: 0;
	font-size: 2.5rem;
	font-weight: 700;
	color: #4a4a5a;
	margin-bottom: 0.75rem;
	letter-spacing: 0.08em;
	position: relative;
	z-index: 1;
}

.glow-title .char {
	display: inline-block;
	opacity: 0;
	transform: translateY(8px);
	filter: blur(8px);
	transition:
		opacity 0.4s ease,
		transform 0.4s ease,
		filter 0.4s ease,
		color 0.15s ease,
		text-shadow 0.15s ease;
}

/* Glow state - when line passes */
.glow-title .char.glow {
	opacity: 1;
	color: #7c6c9a;
	text-shadow:
		0 0 20px rgba(124, 108, 154, 1),
		0 0 40px rgba(124, 108, 154, 0.8);
	filter: blur(0);
	transform: translateY(0);
}

/* Final visible state */
.glow-title .char.visible {
	opacity: 1;
	transform: translateY(0);
	filter: blur(0);
	color: #4a4a5a;
	text-shadow: none;
}

.glow-title .char.space {
	width: 0.35em;
}

/* Japanese title adjustments */
.ja-title {
	letter-spacing: 0.15em;
}

/* Animated subtitle */
.animated-subtitle {
	opacity: 0;
	transform: translateY(10px);
	transition:
		opacity 0.5s ease,
		transform 0.5s ease;
}

.animated-subtitle.visible {
	opacity: 1;
	transform: translateY(0);
}

.subtitle-text {
	color: #6b5b7a;
	font-size: 1rem;
}

/* ===== Testimonials Grid ===== */
.testimonials-grid {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
	gap: 1.5rem;
}

.testimonial-card {
	background: rgba(255, 255, 255, 0.7);
	border: 1px solid rgba(124, 108, 154, 0.2);
	border-radius: 1rem;
	padding: 1.5rem;
	transition: all 0.3s ease;
	backdrop-filter: blur(10px);
}

.testimonial-card:hover {
	border-color: rgba(124, 108, 154, 0.5);
	transform: translateY(-5px);
	box-shadow: 0 15px 40px rgba(124, 108, 154, 0.15);
	background: rgba(255, 255, 255, 0.9);
}

.testimonial-header {
	display: flex;
	align-items: center;
	gap: 1rem;
	margin-bottom: 1rem;
}

.testimonial-avatar {
	width: 48px;
	height: 48px;
	border-radius: 50%;
	background: linear-gradient(135deg, #7c6c9a, #9a8ab0);
	display: flex;
	align-items: center;
	justify-content: center;
	font-weight: 700;
	font-size: 1.25rem;
	color: #fff;
}

.testimonial-info {
	display: flex;
	flex-direction: column;
	gap: 0.25rem;
}

.testimonial-name {
	font-weight: 600;
	color: #4a4a5a;
	font-size: 1rem;
}

.testimonial-rating {
	display: flex;
	align-items: center;
	gap: 0.5rem;
}

.stars {
	color: #e8a040;
	font-size: 0.875rem;
	letter-spacing: 1px;
}

.rating-text {
	color: #8a7a9a;
	font-size: 0.75rem;
	font-weight: 500;
}

.testimonial-text {
	color: #5a5a6a;
	font-size: 0.95rem;
	line-height: 1.7;
	font-style: italic;
}

.testimonial-text::before {
	content: '"';
	color: #7c6c9a;
	font-size: 1.5rem;
	font-weight: 700;
	margin-right: 0.25rem;
}

.testimonial-text::after {
	content: '"';
	color: #7c6c9a;
	font-size: 1.5rem;
	font-weight: 700;
	margin-left: 0.25rem;
}

@media (max-width: 768px) {
	.testimonials-section {
		padding: 4rem 1rem;
	}

	.glow-title {
		font-size: 1.75rem;
	}

	.testimonials-grid {
		grid-template-columns: 1fr;
	}
}
</style>
