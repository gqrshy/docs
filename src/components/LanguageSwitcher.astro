---
// Sticky language switcher - fixed at bottom right
---

<div id="langSwitcher" class="lang-switcher">
	<button id="langToggle" class="lang-toggle" aria-label="Change language">
		<span class="lang-icon">üåê</span>
		<span id="currentLang">EN</span>
		<svg class="lang-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
			<polyline points="6 9 12 15 18 9"/>
		</svg>
	</button>
	<div id="langMenu" class="lang-menu">
		<button class="lang-option" data-lang="en">
			<span class="lang-flag">üá∫üá∏</span>
			<span>English</span>
		</button>
		<button class="lang-option" data-lang="ja">
			<span class="lang-flag">üáØüáµ</span>
			<span>Êó•Êú¨Ë™û</span>
		</button>
	</div>
</div>

<script is:inline>
(function() {
	const STORAGE_KEY = 'gashi_lang';
	const DEFAULT_LANG = 'en';

	// Get saved language or default to English
	function getSavedLang() {
		return localStorage.getItem(STORAGE_KEY) || DEFAULT_LANG;
	}

	// Save language preference
	function saveLang(lang) {
		localStorage.setItem(STORAGE_KEY, lang);
	}

	// Get current language
	function getCurrentLang() {
		return getSavedLang();
	}

	// Update UI
	function updateLangDisplay(lang) {
		const currentLangEl = document.getElementById('currentLang');
		if (currentLangEl) {
			currentLangEl.textContent = lang.toUpperCase();
		}

		// Update active state in menu
		document.querySelectorAll('.lang-option').forEach(opt => {
			opt.classList.toggle('active', opt.dataset.lang === lang);
		});
	}

	// Apply translations
	function applyTranslations(lang) {
		window.currentLang = lang;
		// Dispatch custom event for other components to listen
		window.dispatchEvent(new CustomEvent('langChange', { detail: { lang } }));
	}

	// Initialize
	function init() {
		const lang = getCurrentLang();
		updateLangDisplay(lang);
		applyTranslations(lang);

		// Toggle menu
		const toggle = document.getElementById('langToggle');
		const menu = document.getElementById('langMenu');
		const switcher = document.getElementById('langSwitcher');

		toggle?.addEventListener('click', (e) => {
			e.stopPropagation();
			switcher?.classList.toggle('open');
		});

		// Language selection
		document.querySelectorAll('.lang-option').forEach(option => {
			option.addEventListener('click', () => {
				const newLang = option.dataset.lang;
				saveLang(newLang);
				updateLangDisplay(newLang);
				applyTranslations(newLang);
				switcher?.classList.remove('open');
			});
		});

		// Close menu when clicking outside
		document.addEventListener('click', () => {
			switcher?.classList.remove('open');
		});
	}

	// Export for other scripts
	window.GashiLang = {
		get: getCurrentLang,
		set: (lang) => {
			saveLang(lang);
			updateLangDisplay(lang);
			applyTranslations(lang);
		}
	};

	// Run on DOM ready
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', init);
	} else {
		init();
	}
})();
</script>

<style>
.lang-switcher {
	position: fixed;
	bottom: 2rem;
	right: 2rem;
	z-index: 9999;
}

.lang-toggle {
	display: flex;
	align-items: center;
	gap: 0.5rem;
	background: linear-gradient(135deg, rgba(124, 58, 237, 0.9) 0%, rgba(147, 51, 234, 0.9) 100%);
	border: 1px solid rgba(255, 255, 255, 0.2);
	border-radius: 50px;
	padding: 0.75rem 1rem;
	color: #fff;
	font-size: 0.9rem;
	font-weight: 500;
	cursor: pointer;
	box-shadow: 0 4px 20px rgba(124, 58, 237, 0.4);
	transition: box-shadow 0.2s ease;
	backdrop-filter: blur(10px);
	animation: jellyOutDown 0.4s ease forwards;
}

.lang-toggle:hover {
	box-shadow: 0 6px 25px rgba(124, 58, 237, 0.5);
	animation: jellyInUp 0.35s ease forwards;
}

.lang-icon {
	font-size: 1.1rem;
}

.lang-arrow {
	transition: transform 0.2s ease;
}

.lang-switcher.open .lang-arrow {
	transform: rotate(180deg);
}

.lang-menu {
	position: absolute;
	bottom: 100%;
	right: 0;
	margin-bottom: 0.5rem;
	background: rgba(15, 10, 26, 0.95);
	border: 1px solid rgba(124, 58, 237, 0.3);
	border-radius: 12px;
	padding: 0.5rem;
	min-width: 140px;
	opacity: 0;
	visibility: hidden;
	transform: translateY(10px);
	transition: all 0.2s ease;
	backdrop-filter: blur(10px);
	box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
}

.lang-switcher.open .lang-menu {
	opacity: 1;
	visibility: visible;
	transform: translateY(0);
}

.lang-option {
	display: flex;
	align-items: center;
	gap: 0.75rem;
	width: 100%;
	padding: 0.625rem 0.875rem;
	background: transparent;
	border: none;
	border-radius: 8px;
	color: rgba(255, 255, 255, 0.8);
	font-size: 0.9rem;
	cursor: pointer;
	transition: background 0.2s ease, color 0.2s ease;
	text-align: left;
	animation: jellyOut 0.4s ease forwards;
}

.lang-option:hover {
	background: rgba(124, 58, 237, 0.2);
	color: #fff;
	animation: jellyIn 0.35s ease forwards;
}

.lang-option.active {
	background: rgba(124, 58, 237, 0.3);
	color: #a78bfa;
}

.lang-flag {
	font-size: 1.2rem;
}

@media (max-width: 576px) {
	.lang-switcher {
		bottom: 1rem;
		right: 1rem;
	}

	.lang-toggle {
		padding: 0.625rem 0.875rem;
		font-size: 0.85rem;
	}
}
</style>
